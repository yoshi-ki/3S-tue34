// (c) Michael Buro 1992-2002, licensed under the GNU Public License, version 2

/* make patterns, 1.95 */
/* first disc has highest value 3.95 */


#include "main.h"

#include "sboard.h"
#include "board.h"
#include "crt.h"
#include "goodies.h"
#include "game.h"
#include "tab.h"
#include "patt.h"
#include "trans.h"



#define ARRAY true

#define ALL_PATTERNS false

#if 0
  {
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  },
#endif

 
typedef struct {

  SPFELD sf;
  char   name[100];
  bool   is_line;
  int    discs;
  int    diff;

} PATT_DEF;



PATT_DEF mpatt[] = {

#if 0 

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,1,2,3,4,5,6,7,8,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "HV1", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,1,2,3,4,5,6,7,8,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "HV2", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,1,2,3,4,5,6,7,8,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "HV3", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,1,2,3,4,5,6,7,8,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "HV4", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,8,0,
    0,0,0,0,0,0,0,7,0,0,
    0,0,0,0,0,0,6,0,0,0,
    0,0,0,0,0,5,0,0,0,0,
    0,0,0,0,4,0,0,0,0,0,
    0,0,0,3,0,0,0,0,0,0,
    0,0,2,0,0,0,0,0,0,0,
    0,1,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "D1", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,7,0,0,
    0,0,0,0,0,0,6,0,0,0,
    0,0,0,0,0,5,0,0,0,0,
    0,0,0,0,4,0,0,0,0,0,
    0,0,0,3,0,0,0,0,0,0,
    0,0,2,0,0,0,0,0,0,0,
    0,1,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "D2", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,6,0,0,0,
    0,0,0,0,0,5,0,0,0,0,
    0,0,0,0,4,0,0,0,0,0,
    0,0,0,3,0,0,0,0,0,0,
    0,0,2,0,0,0,0,0,0,0,
    0,1,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "D3", 1
  },  

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,5,0,0,0,0,
    0,0,0,0,4,0,0,0,0,0,
    0,0,0,3,0,0,0,0,0,0,
    0,0,2,0,0,0,0,0,0,0,
    0,1,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "D4", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,4,0,0,0,0,0,
    0,0,0,3,0,0,0,0,0,0,
    0,0,2,0,0,0,0,0,0,0,
    0,1,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "D5", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,1,2,3,4,5,0,0,0,0,
    0,6,7,8,9,10,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "2X5", 0
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,1,2,3,0,0,0,0,0,0,
    0,4,5,6,0,0,0,0,0,0,
    0,7,8,9,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "3X3", 0
  }

#else


  // new approach C9 instead of 4-diag

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,1,2,3,4,5,6,7,8,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "HV1", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,1,2,3,4,5,6,7,8,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "HV2", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,1,2,3,4,5,6,7,8,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "HV3", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,1,2,3,4,5,6,7,8,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "HV4", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,8,0,
    0,0,0,0,0,0,0,7,0,0,
    0,0,0,0,0,0,6,0,0,0,
    0,0,0,0,0,5,0,0,0,0,
    0,0,0,0,4,0,0,0,0,0,
    0,0,0,3,0,0,0,0,0,0,
    0,0,2,0,0,0,0,0,0,0,
    0,1,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "D1", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,7,0,0,
    0,0,0,0,0,0,6,0,0,0,
    0,0,0,0,0,5,0,0,0,0,
    0,0,0,0,4,0,0,0,0,0,
    0,0,0,3,0,0,0,0,0,0,
    0,0,2,0,0,0,0,0,0,0,
    0,1,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "D2", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,6,0,0,0,
    0,0,0,0,0,5,0,0,0,0,
    0,0,0,0,4,0,0,0,0,0,
    0,0,0,3,0,0,0,0,0,0,
    0,0,2,0,0,0,0,0,0,0,
    0,1,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "D3", 1
  },  

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,5,0,0,0,0,
    0,0,0,0,4,0,0,0,0,0,
    0,0,0,3,0,0,0,0,0,0,
    0,0,2,0,0,0,0,0,0,0,
    0,1,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "D4", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,4,0,0,0,0,0,
    0,0,0,3,0,0,0,0,0,0,
    0,0,2,0,0,0,0,0,0,0,
    0,1,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "D5", 1
  },

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,1,2,3,4,0,0,0,0,0,
    0,5,6,7,8,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "R1"
  }

#if 0
  ,

  {{{
    0,0,0,0,0,0,0,0,0,0,
    0,1,2,3,0,0,0,0,0,0,
    0,4,5,6,0,0,0,0,0,0,
    0,7,8,9,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0
  }, 0 },
  "3X3"
  }
#endif
 
#endif

};

const int PATT_NUM = sizeof(mpatt)/sizeof(mpatt[0]);


int pnum;

#define PATT_MAX 200

PATT_DEF pattinfo[PATT_MAX];



void NewPat(SPFELD *psf, char *name, int sub, bool is_line)
{
  int i, j, s=0, pos1, pos2;

  if (pnum >= PATT_MAX) Error("too many patterns");

  pattinfo[pnum].sf = *psf;

  printf("#define P%s%c\t%2d  /* ", name, sub+'A', pnum);

  pos1 = pos2 = 0;

  for (i=1;; i++) {

    FOR (j, 100) if (psf->p[j] == i) break;

    if (i == 1) pos1 = j;
    if (i == 2) pos2 = j;

    if (j >= 100) break;

    if (i > 1) printf(",");
    GKoorAus(j);
  }

  printf(" */\n");

  FOR (j, 100) if (psf->p[j]) s++;

  if (s != i-1) Error("error in pattern");

  pattinfo[pnum].discs = s;
  pattinfo[pnum].is_line = is_line;

  if (is_line) {

    if (!pos1 || !pos2) Error("posi = 0?");

    pattinfo[pnum].diff = pos2-pos1;

  } else pattinfo[pnum].diff = 0;

  pnum++;
}


void _abort(void) {}


int main(void)
{ 
  int i, j, k, l, n, sub;
  SPFELD sf, sft[8];

  /* prepare patterns */

  pnum = 1;

  FOR (j, PATT_NUM) {

    int t_perm[8] = { 0,5,3,6,1,2,4,7 };  // for clockwise orientation of edges

    sub = 0;
    memcpy(sf.p, mpatt[j].sf.p, sizeof(sf.p));

    Transform(&sf, sft);

    FOR (k, 8) {

      for (n=0; n < k; n++) {

        FOR (l, 100) {

          if ((sft[t_perm[k]].p[l] != 0) != (sft[t_perm[n]].p[l] != 0)) break;

        }

        if (l >= 100) break;

      }

      if (ALL_PATTERNS || n >= k) 
	NewPat(&sft[t_perm[k]], mpatt[j].name, sub++, mpatt[j].is_line);

    }

  }


/* compute position information */

  FOR (i, 100) {

    k = 0;

#if ARRAY
    printf("{   /* "); KoorAus(i); printf(" */\n");
#else
    printf("  case %2d:\n", i);
#endif

    for (j=1; j < pnum; j++) {

      if (pattinfo[j].sf.p[i]) {

#if ARRAY
        printf("  { %2d, %d, %d, %d, %d }", 
          j, pattinfo[j].discs - pattinfo[j].sf.p[i],
          pattinfo[j].is_line, pattinfo[j].discs, pattinfo[j].diff);
        if (k < DELTA_MAX-1) printf(",\n"); else printf("\n");
#else
        printf("    pnb->NewPatt.st[%2d] += #%4d;\n", j, 2*Pot3[pattinfo[j].sf.p[i]-1]);
#endif
        k++;
      }

    }

    if (k > DELTA_MAX) Error("too many delta entries\n");

#if ARRAY
    for (; k < DELTA_MAX; k++) { 
      printf("  {  0, 0, 0, 0, 0 }"); 
      if (k < DELTA_MAX-1) printf(",\n"); else printf("\n");
    }

    printf("},\n");
#else
    printf("    break;\n");
#endif

  }



  return 0;
}






